Teradata Jaqy Console 1.0
-- 0/0 - 0 ----------------------------------------------------------------
--------------------------------------------------------------------------
-- Transaction test
--------------------------------------------------------------------------
.help commit
No detailed help information.
-- 0/1 - 0 ----------------------------------------------------------------
.help rollback
No detailed help information.
-- 0/2 - 0 ----------------------------------------------------------------
.commit
-- error: Current session is closed.
-- 0/3 - 0 ----------------------------------------------------------------
.rollback
-- error: Current session is closed.
-- 0/4 - 0 ----------------------------------------------------------------

.run ../common/mysql_setup.sql
-- Running script: ../common/mysql_setup.sql
-- 0/5 - 0 ----------------------------------------------------------------
.open -u root mysql://localhost/?useUnicode=true&characterEncoding=utf-8
-- 0/6 - 0 ----------------------------------------------------------------
USE vagrant;
-- success. update count = 0
-- 1/6 - 0 ----------------------------------------------------------------

CREATE TABLE MyTable
(
	a	INTEGER PRIMARY KEY,
	b	VARCHAR(200)
);
-- success. update count = 0
-- 2/6 - 0 ----------------------------------------------------------------

.autocommit off
-- 2/7 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (1, '1');
-- success. update count = 1
-- 3/7 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (2, '2');
-- success. update count = 1
-- 4/7 - 0 ----------------------------------------------------------------
.commit
-- 4/8 - 0 ----------------------------------------------------------------

SELECT * FROM MyTable ORDER BY a;
-- success --
a b
- -
1 1
2 2
-- activity count = 2
-- 5/8 - 0 ----------------------------------------------------------------

INSERT INTO MyTable VALUES (3, '3');
-- success. update count = 1
-- 6/8 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (4, '4');
-- success. update count = 1
-- 7/8 - 0 ----------------------------------------------------------------
.rollback
-- 7/9 - 0 ----------------------------------------------------------------

SELECT * FROM MyTable ORDER BY a;
-- success --
a b
- -
1 1
2 2
-- activity count = 2
-- 8/9 - 0 ----------------------------------------------------------------

.autocommit on
-- 8/10 - 0 ---------------------------------------------------------------

INSERT INTO MyTable VALUES (3, '4');
-- success. update count = 1
-- 9/10 - 0 ---------------------------------------------------------------
INSERT INTO MyTable VALUES (3, '4');
-- failure 1062: [23000] Duplicate entry '3' for key 'PRIMARY'
-- 10/10 - 0 --------------------------------------------------------------
.rollback
-- failure 0: [08003] Can't call rollback when autocommit=true
-- 10/11 - 0 --------------------------------------------------------------

SELECT * FROM MyTable ORDER BY a, b;
-- success --
a b
- -
1 1
2 2
3 4
-- activity count = 3
-- 11/11 - 0 --------------------------------------------------------------

DROP TABLE MyTable;
-- success. update count = 0
-- 12/11 - 0 --------------------------------------------------------------

.close
Session 0 is now closed.
-- 12/12 - 0 --------------------------------------------------------------

