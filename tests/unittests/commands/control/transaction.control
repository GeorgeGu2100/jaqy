Teradata Jaqy Console 1.0
-- 0/0 - 0 ----------------------------------------------------------------
--------------------------------------------------------------------------
-- Transaction test
--------------------------------------------------------------------------
.run ../common/mysql_setup.sql
-- Running script: ../common/mysql_setup.sql
-- 0/1 - 0 ----------------------------------------------------------------
.open -u root mysql://localhost/?useUnicode=true&characterEncoding=utf-8
-- 0/2 - 0 ----------------------------------------------------------------
USE vagrant;
-- success. update count = 0
-- 1/2 - 0 ----------------------------------------------------------------

CREATE TABLE MyTable
(
	a	INTEGER PRIMARY KEY,
	b	VARCHAR(200)
);
-- success. update count = 0
-- 2/2 - 0 ----------------------------------------------------------------

.autocommit off
-- 2/3 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (1, '1');
-- success. update count = 1
-- 3/3 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (2, '2');
-- success. update count = 1
-- 4/3 - 0 ----------------------------------------------------------------
.commit
-- 4/4 - 0 ----------------------------------------------------------------

SELECT * FROM MyTable ORDER BY a;
-- success --
a b
- -
1 1
2 2
-- activity count = 2
-- 5/4 - 0 ----------------------------------------------------------------

INSERT INTO MyTable VALUES (3, '3');
-- success. update count = 1
-- 6/4 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (4, '4');
-- success. update count = 1
-- 7/4 - 0 ----------------------------------------------------------------
.rollback
-- 7/5 - 0 ----------------------------------------------------------------

SELECT * FROM MyTable ORDER BY a;
-- success --
a b
- -
1 1
2 2
-- activity count = 2
-- 8/5 - 0 ----------------------------------------------------------------

.autocommit on
-- 8/6 - 0 ----------------------------------------------------------------

INSERT INTO MyTable VALUES (3, '4');
-- success. update count = 1
-- 9/6 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (3, '4');
-- failure 1062: [23000] Duplicate entry '3' for key 'PRIMARY'
-- 10/6 - 0 ---------------------------------------------------------------
.rollback
-- failure 0: [08003] Can't call rollback when autocommit=true
-- 10/7 - 0 ---------------------------------------------------------------

SELECT * FROM MyTable ORDER BY a, b;
-- success --
a b
- -
1 1
2 2
3 4
-- activity count = 3
-- 11/7 - 0 ---------------------------------------------------------------

DROP TABLE MyTable;
-- success. update count = 0
-- 12/7 - 0 ---------------------------------------------------------------

.close
Session 0 is now closed.
-- 12/8 - 0 ---------------------------------------------------------------

